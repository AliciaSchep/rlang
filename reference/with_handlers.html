<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Establish handlers on the stack — with_handlers • rlang</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Establish handlers on the stack — with_handlers" />

<meta property="og:description" content="Condition handlers are functions established on the evaluation
stack (see ctxt_stack()) that are called by R when a condition is
signalled (see cnd_signal() and abort() for two common signal
functions). They come in two types: exiting handlers, which jump
out of the signalling context and are transferred to
with_handlers() before being executed. And calling handlers,
which are executed within the signal functions." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rlang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.4.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Life cycle</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Establish handlers on the stack</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/rlang/blob/master/R/cnd-handlers.R'><code>R/cnd-handlers.R</code></a></small>
    <div class="hidden name"><code>with_handlers.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Condition handlers are functions established on the evaluation
stack (see <code><a href='stack.html'>ctxt_stack()</a></code>) that are called by R when a condition is
signalled (see <code><a href='cnd_signal.html'>cnd_signal()</a></code> and <code><a href='abort.html'>abort()</a></code> for two common signal
functions). They come in two types: exiting handlers, which jump
out of the signalling context and are transferred to
<code>with_handlers()</code> before being executed. And calling handlers,
which are executed within the signal functions.</p>
    
    </div>

    <pre class="usage"><span class='fu'>with_handlers</span>(<span class='no'>.expr</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.expr</th>
      <td><p>An expression to execute in a context where new
handlers are established. The underscored version takes a quoted
expression or a quoted formula.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Named handlers. These should be functions of one
argument. These handlers are treated as exiting by default. Use
<code><a href='exiting.html'>calling()</a></code> to specify a calling handler. These dots support
<a href='tidy-dots.html'>tidy dots</a> features and are passed to <code><a href='as_function.html'>as_function()</a></code>
to enable the formula shortcut for lambda functions.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>An exiting handler is taking charge of the condition. No other
handler on the stack gets a chance to handle the condition. The
handler is executed and <code>with_handlers()</code> returns the return value
of that handler. On the other hand, in place handlers do not
necessarily take charge. If they return normally, they decline to
handle the condition, and R looks for other handlers established on
the evaluation stack. Only by jumping to an earlier call frame can
a calling handler take charge of the condition and stop the
signalling process. Sometimes, a muffling restart has been
established for the purpose of jumping out of the signalling
function but not out of the context where the condition was
signalled, which allows execution to resume normally. See
<code><a href='cnd_muffle.html'>cnd_muffle()</a></code> and the <code>mufflable</code> argument of <code><a href='cnd_signal.html'>cnd_signal()</a></code>.</p>
<p>Exiting handlers are established first by <code>with_handlers()</code>, and in
place handlers are installed in second place. The latter handlers
thus take precedence over the former.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='exiting.html'>exiting()</a></code>, <code><a href='exiting.html'>calling()</a></code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Signal a condition with signal():</span>
<span class='no'>fn</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>() {
  <span class='fu'>g</span>()
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/cat'>cat</a></span>(<span class='st'>"called?\n"</span>)
  <span class='st'>"fn() return value"</span>
}
<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>() {
  <span class='fu'>h</span>()
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/cat'>cat</a></span>(<span class='st'>"called?\n"</span>)
}
<span class='no'>h</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>() {
  <span class='fu'><a href='abort.html'>signal</a></span>(<span class='st'>"A foobar condition occurred"</span>, <span class='st'>"foo"</span>)
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/cat'>cat</a></span>(<span class='st'>"called?\n"</span>)
}

<span class='co'># Exiting handlers jump to with_handlers() before being</span>
<span class='co'># executed. Their return value is handed over:</span>
<span class='no'>handler</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>c</span>) <span class='st'>"handler return value"</span>
<span class='fu'>with_handlers</span>(<span class='fu'>fn</span>(), <span class='kw'>foo</span> <span class='kw'>=</span> <span class='fu'><a href='exiting.html'>exiting</a></span>(<span class='no'>handler</span>))</div><div class='output co'>#&gt; [1] "handler return value"</div><div class='input'>
<span class='co'># Handlers are exiting by default so you can omit the adjective:</span>
<span class='fu'>with_handlers</span>(<span class='fu'>fn</span>(), <span class='kw'>foo</span> <span class='kw'>=</span> <span class='no'>handler</span>)</div><div class='output co'>#&gt; [1] "handler return value"</div><div class='input'>
<span class='co'># In place handlers are called in turn and their return value is</span>
<span class='co'># ignored. Returning just means they are declining to take charge of</span>
<span class='co'># the condition. However, they can produce side-effects such as</span>
<span class='co'># displaying a message:</span>
<span class='no'>some_handler</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>c</span>) <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/cat'>cat</a></span>(<span class='st'>"some handler!\n"</span>)
<span class='no'>other_handler</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>c</span>) <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/cat'>cat</a></span>(<span class='st'>"other handler!\n"</span>)
<span class='fu'>with_handlers</span>(<span class='fu'>fn</span>(), <span class='kw'>foo</span> <span class='kw'>=</span> <span class='fu'><a href='exiting.html'>calling</a></span>(<span class='no'>some_handler</span>), <span class='kw'>foo</span> <span class='kw'>=</span> <span class='fu'><a href='exiting.html'>calling</a></span>(<span class='no'>other_handler</span>))</div><div class='output co'>#&gt; some handler!
#&gt; other handler!
#&gt; called?
#&gt; called?
#&gt; called?</div><div class='output co'>#&gt; [1] "fn() return value"</div><div class='input'>
<span class='co'># If an in place handler jumps to an earlier context, it takes</span>
<span class='co'># charge of the condition and no other handler gets a chance to</span>
<span class='co'># deal with it. The canonical way of transferring control is by</span>
<span class='co'># jumping to a restart. See with_restarts() and restarting()</span>
<span class='co'># documentation for more on this:</span>
<span class='no'>exiting_handler</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>c</span>) <span class='fu'><a href='rst_list.html'>rst_jump</a></span>(<span class='st'>"rst_foo"</span>)
<span class='no'>fn2</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>() {
  <span class='fu'><a href='with_restarts.html'>with_restarts</a></span>(<span class='fu'>g</span>(), <span class='kw'>rst_foo</span> <span class='kw'>=</span> <span class='kw'>function</span>() <span class='st'>"restart value"</span>)
}
<span class='fu'>with_handlers</span>(<span class='fu'>fn2</span>(), <span class='kw'>foo</span> <span class='kw'>=</span> <span class='fu'><a href='exiting.html'>calling</a></span>(<span class='no'>exiting_handler</span>), <span class='kw'>foo</span> <span class='kw'>=</span> <span class='fu'><a href='exiting.html'>calling</a></span>(<span class='no'>other_handler</span>))</div><div class='output co'>#&gt; [1] "restart value"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

